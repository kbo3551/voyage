<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdu.voyage.mapper.ProductMapper">
	
	<!-- 숙소-건물 전체 목록 조회를 위한 resultMap -->
	<resultMap type="com.gdu.voyage.vo.AccomBuilding" id="resultAccomBuilding">
		<!-- building -->
		<id column="accom_building_no" property="accomBuildingNo"/>
		<result column="host_no" property="hostNo"/>
		<result column="accom_building_name" property="accomBuildingName"/>
		<result column="accom_building_description" property="accomBuildingDescription"/>
		<result column="accom_building_phone" property="accomBuildingPhone"/>
		<result column="accom_building_state" property="accomBuildingState"/>
		<result column="accom_building_state_admin" property="accomBuildingStateAdmin"/>
		<result column="create_date" property="createDate"/>
		<result column="update_date" property="updateDate"/>
		<!-- facility -->
		<collection property="accomBuildingFacilityList" ofType="com.gdu.voyage.vo.AccomBuildingFacility">
			<id column="accom_building_facility_no" property="accomBuildingFacilityNo"/>
			<result column="accom_building_facility_name" property="accomBuildingFacilityName"/>
		</collection>
		<!-- image -->
		<collection property="accomBuildingImageList" ofType="com.gdu.voyage.vo.AccomBuildingImage">
			<id column="accom_building_image_no" property="accomBuildingImageNo"/>
			<result column="accom_building_image_name" property="accomBuildingImageName"/>
			<result column="accom_building_image_ext" property="accomBuildingImageExt"/>
		</collection>
		<!-- spot -->
		<collection property="accomBuildingSpotList" ofType="com.gdu.voyage.vo.AccomBuildingSpot">
			<id column="accom_building_spot_no" property="accomBuildingSpotNo"/>
		</collection>
		<!-- address -->
		<collection property="accomAddress" ofType="com.gdu.voyage.vo.AccomAddress">
			<id column="accom_address_no" property="accomAddressNo"/>
			<result column="accom_address_zip" property="accomAddressZip"/>
		</collection>
		<!-- hashtag -->
		<collection property="hashtagList" ofType="com.gdu.voyage.vo.Hashtag">
			<id column="hashtag_no" property="hashtagNo"/>
		</collection>
	</resultMap>
	
	<!-- 숙소-건물 인기 시설 조회를 위한 resultMap -->
	<resultMap type="map" id="resultAccomFacilityByBest">
		<result column="accom_building_facility_name" property="accomBuildingFacilityName"/>
		<result column="COUNT(accom_building_facility_name)" property="accomBuildingFacilityBest"/>
	</resultMap>
	
	<!-- 숙소-건물 인기 지역 조회를 위한 resultMap -->
	<resultMap type="map" id="resultAccomAddressByBest">
		<result column="SUBSTRING_INDEX(accom_address_zip, ' ', 1)" property="accomAddressZip"/>
		<result column="COUNT(accom_address_zip)" property="accomAddressZipBest"/>
	</resultMap>
	
	<!-- 체험 전체 목록 조회를 위한 resultMap -->
	<resultMap type="com.gdu.voyage.vo.Activity" id="resultActivity">
		<!-- building -->
		<id column="activity_no" property="activityNo"/>
		<result column="host_no" property="hostNo"/>
		<result column="activity_name" property="activityName"/>
		<result column="activity_description" property="activityDescription"/>
		<result column="activity_phone" property="activityPhone"/>
		<result column="activity_state" property="activityState"/>
		<result column="activity_state_admin" property="activityStateAdmin"/>
		<result column="create_date" property="createDate"/>
		<result column="update_date" property="updateDate"/>
		<!-- image -->
		<collection property="activityImageList" ofType="com.gdu.voyage.vo.ActivityImage">
			<id column="activity_image_no" property="activityImageNo"/>
			<result column="activity_image_name" property="activityImageName"/>
			<result column="activity_image_ext" property="activityImageExt"/>
		</collection>
		<!-- spot -->
		<collection property="activitySpotList" ofType="com.gdu.voyage.vo.ActivitySpot">
			<id column="activity_spot_no" property="activitySpotNo"/>
		</collection>
		<!-- address -->
		<collection property="activityAddress" ofType="com.gdu.voyage.vo.ActivityAddress">
			<id column="activity_address_no" property="activityAddressNo"/>
			<result column="activity_address_zip" property="activityAddressZip"/>
		</collection>
		<!-- hashtag -->
		<collection property="hashtagList" ofType="com.gdu.voyage.vo.Hashtag">
			<id column="hashtag_no" property="hashtagNo"/>
		</collection>
	</resultMap>
	
	<!-- 체험 인기 지역 조회를 위한 resultMap -->
	<resultMap type="map" id="resultActivityAddressByBest">
		<result column="SUBSTRING_INDEX(activity_address_zip, ' ', 1)" property="activityAddressZip"/>
		<result column="COUNT(activity_address_zip)" property="activityAddressZipBest"/>
	</resultMap>
	
	<!-- 숙소-건물 목록 조회 -->
	<select id="selectAccomBuildingList" resultMap="resultAccomBuilding">
		SELECT                                      
			b.accom_building_no,
			b.host_no,
			b.accom_building_name,
			b.accom_building_description, 
			b.accom_building_phone,
			b.accom_building_state,
			b.accom_building_state_admin,
			b.create_date,
			b.update_date,
			f.accom_building_facility_no,
			f.accom_building_no,
			f.accom_building_facility_name,
			i.accom_building_image_no,
			i.accom_building_image_name,
			i.accom_building_image_ext,
			s.accom_building_spot_no,
			a.accom_address_no,
			a.accom_address_zip,
			h.hashtag_no
		FROM      
			accom_building b
			LEFT JOIN accom_address a
				ON b.accom_building_no = a.accom_building_no
			LEFT JOIN accom_building_image i
				ON b.accom_building_no = i.accom_building_no
			LEFT JOIN accom_building_facility f
				ON b.accom_building_no = f.accom_building_no
			LEFT JOIN accom_building_spot s
				ON b.accom_building_no = s.accom_building_no
			LEFT JOIN hashtag h
				ON b.accom_building_no = h.iden_no                                    
		WHERE                                      
			accom_building_state_admin = '승인완료' AND accom_building_state = '공개'
		ORDER BY
			b.update_date DESC;
	</select>
	
	<!-- 숙소-시설 인기 시설 조회 -->
	<select id="selectAccomBuildingFacilityByBest" resultMap="resultAccomFacilityByBest">
		SELECT
			accom_building_facility_name,
			COUNT(accom_building_facility_name)
		FROM
			accom_building_facility
		GROUP BY
			accom_building_facility_name
		ORDER BY
			COUNT(accom_building_facility_name) DESC
		LIMIT
			0, 6;
	</select>
	
	<!-- 숙소-주소 인기 지역 조회 -->
	<select id="selectAccomAddressByBest" resultMap="resultAccomAddressByBest">
		SELECT
			SUBSTRING_INDEX(accom_address_zip, ' ', 1),
			COUNT(accom_address_zip)
		FROM
			accom_address
		GROUP BY
			SUBSTRING_INDEX(accom_address_zip, ' ', 1)
		ORDER BY
			COUNT(accom_address_zip) DESC
		LIMIT
			0, 8;
	</select>
	
	<!-- 숙소-건물 목록 검색 조회 -->
	<select id="selectAccomBuildingListBySearch" parameterType="Map" resultMap="resultAccomBuilding">
		SELECT                                      
			b.accom_building_no,
			b.host_no,
			b.accom_building_name,
			b.accom_building_description, 
			b.accom_building_phone,
			b.accom_building_state,
			b.accom_building_state_admin,
			b.create_date,
			b.update_date,
			f.accom_building_facility_no,
			f.accom_building_no,
			f.accom_building_facility_name,
			i.accom_building_image_no,
			i.accom_building_image_name,
			i.accom_building_image_ext,
			s.accom_building_spot_no,
			a.accom_address_no,
			a.accom_address_zip,
			h.hashtag_no,
			h.hashtag
		FROM      
			accom_building b
			LEFT JOIN accom_address a
				ON b.accom_building_no = a.accom_building_no
			LEFT JOIN accom_building_image i
				ON b.accom_building_no = i.accom_building_no
			LEFT JOIN accom_building_facility f
				ON b.accom_building_no = f.accom_building_no
			LEFT JOIN accom_building_spot s
				ON b.accom_building_no = s.accom_building_no
			LEFT JOIN hashtag h
				ON b.accom_building_no = h.iden_no                                    
		WHERE                                      
			accom_building_state_admin = '승인완료' AND accom_building_state = '공개'
			AND
			<!-- 입렵(해시태그, 건물 이름, 건물 소개글) 검색 -->
			<if test="#{searchWord} != null">
				(h.hashtag LIKE '%${searchWord}%' OR
				b.accom_building_name LIKE '%${searchWord}%' OR
				b.accom_building_description LIKE '%${searchWord}%'	OR
				f.accom_building_facility_name LIKE '%${searchWord}%' OR
				a.accom_address_zip LIKE '%${searchWord}%')			
			</if>
			AND
			<!-- 지역 검색 -->
			<if test="#{searchAccomAddress} != null">
				(a.accom_address_zip LIKE '%${searchAccomAddress}%')		
			</if>
<!-- 			AND -->
<!-- 				f.accom_building_facility_name  -->
<!-- 				시설 검색 -->
<!-- 				<if test="#{searchFacilityList} != null"> -->
<!-- 					<foreach collection="searchFacilityList" item="facility" open="LIKE '%" close="%'" separator="%' LIKE '%"> -->
<!-- 						${searchFacilityList} -->
<!-- 						<foreach collection="facility" item="f" open="(" close=")" separator=","> -->
<!-- 							${f.searchFacilityList} -->
<!-- 						</foreach> -->
<!-- 					</foreach> -->
<!-- 				</if>	 -->
			
		ORDER BY
			b.update_date DESC;
	</select>
	
	<!-- 체험 목록 조회 -->
	<select id="selectActivityList" resultMap="resultActivity">
		SELECT                                      
			ac.activity_no,
			ac.host_no,
			ac.activity_name,
			ac.activity_description, 
			ac.activity_phone,
			ac.activity_state,
			ac.activity_state_admin,
			ac.create_date,
			ac.update_date,
			i.activity_image_no,
			i.activity_image_name,
			i.activity_image_ext,
			s.activity_spot_no,
			a.activity_address_no,
			a.activity_address_zip,
			h.hashtag_no
		FROM      
			activity ac
			LEFT JOIN activity_address a
				ON ac.activity_no = a.activity_no
			LEFT JOIN activity_image i
				ON ac.activity_no = i.activity_no
			LEFT JOIN activity_spot s
				ON ac.activity_no = s.activity_no
			LEFT JOIN hashtag h
				ON ac.activity_no = h.iden_no                                    
		WHERE                                      
			activity_state_admin = '승인완료' AND activity_state = '공개'
		ORDER BY
			ac.update_date DESC;
	</select>
	
	<!-- 체험-주소 인기 지역 조회 -->
	<select id="selectActivityAddressByBest" resultMap="resultActivityAddressByBest">
		SELECT
			SUBSTRING_INDEX(activity_address_zip, ' ', 1),
			COUNT(activity_address_zip)
		FROM
			activity_address
		GROUP BY
			SUBSTRING_INDEX(activity_address_zip, ' ', 1)
		ORDER BY
			COUNT(activity_address_zip) DESC
		LIMIT
			0, 8;
	</select>
	
		<!-- [사용자] 숙소_건물 상세 페이지 출력 -->
	<resultMap type="com.gdu.voyage.vo.AccomBuilding" id="resuliAccomBuilding">
		<id column="accom_building_no" property="accomBuildingNo"/>
		<result column="host_no" property="hostNo"/>
		<result column="accom_building_name" property="accomBuildingName"/>
		<result column="accom_building_description" property="accomBuildingDescription"/>
		<result column="accom_building_phone" property="accomBuildingPhone"/>
		<result column="accom_building_state" property="accomBuildingState"/>
		<result column="accom_building_state_admin" property="accomBuildingStateAdmin"/>
		<result column="create_date" property="createDate"/>
		<result column="update_date" property="updateDate"/>
		<association property="accomAddress" javaType="com.gdu.voyage.vo.AccomAddress">
			<id column="accom_address_no" property="accomAddressNo"/>
			<result column="accom_address_postal_code" property="accomAddressPotalCode"/>
			<result column="accom_address_zip" property="accomAddressZip"/>
			<result column="accom_address_detail" property="accomAddressDetail"/>
			<result column="create_date" property="createDate"/>
			<result column="update_date" property="updateDate"/>
		</association>
		<collection property="accomBuildingImageList" ofType="com.gdu.voyage.vo.AccomBuildingImage" javaType="list">
			<id column="accom_building_image_no" property="accomBuildingImageNo"/>
			<result column="accom_building_image_name" property="accomBuildingImageName"/>
			<result column="accom_building_image_ext" property="accomBuildingImageExt"/>
			<result column="accom_building_image_size" property="accomBuildingImageSize"/>
		</collection>
		<collection property="accomBuildingFacilityList" ofType="com.gdu.voyage.vo.AccomBuildingFacility">
			<id column="accom_building_facility_no" property="accomBuildingFacilityNo"/>
			<result column="accom_building_facility_name" property="accomBuildingFacilityName"/>
		</collection>
		<collection property="accomBuildingSpotList" ofType="com.gdu.voyage.vo.AccomBuildingSpot">
			<id column="accom_building_spot_no" property="accomBuildingSpotNo"/>
			<result column="accom_building_spot_name" property="accomBuildingSpotName"/>
			<result column="accom_building_spot_category" property="accomBuildingSpotCategory"/>
			<result column="accom_building_spot_description" property="accomBuildingSpotDescription"/>
		</collection>
		<collection property="hashtagList" ofType="com.gdu.voyage.vo.Hashtag">
			<id column="hashtag_no" property="hashtagNo"/>
			<result column="iden_no" property="idenNo"/>
			<result column="table_name" property="tableName"/>
			<result column="hashtag" property="hashtag"/>
			<result column="create_date" property="createDate"/>
		</collection>
	</resultMap>

	<select id="selectAccomBuildingOne" parameterType="int" resultMap="resuliAccomBuilding">
		SELECT
			a.accom_building_no,
			a.host_no,
			a.accom_building_name,
			a.accom_building_description,
			a.accom_building_phone,
			a.accom_building_state,
			aa.accom_address_postal_code,
			aa.accom_address_zip,
			aa.accom_address_detail,
			ai.accom_building_image_name,
			ai.accom_building_image_ext,
			af.accom_building_facility_name,
			aspot.accom_building_spot_name,
			aspot.accom_building_spot_category,
			aspot.accom_building_spot_description,
			ah.hashtag
		FROM
			accom_building a
			LEFT JOIN accom_address aa
				ON a.accom_building_no = aa.accom_building_no
			LEFT JOIN accom_building_image ai
				ON a.accom_building_no = ai.accom_building_no
			LEFT JOIN accom_building_facility af
				ON a.accom_building_no = af.accom_building_no
			LEFT JOIN accom_building_spot aspot
				ON a.accom_building_no = aspot.accom_building_no
			LEFT JOIN hashtag ah
				ON a.accom_building_no = ah.iden_no
		WHERE 
			ah.table_name = '건물' 
			AND a.accom_building_state_admin = '승인완료'
			AND a.accom_building_no = #{accomBuildingNo}
	</select>

	<!-- 숙소-건물 상세 조회 -->
<!-- 	<select id="selectAccomBuildingList" resultMap="resultAccomBuilding"> -->
<!-- 		SELECT                                       -->
<!-- 			b.accom_building_no, -->
<!-- 			b.host_no, -->
<!-- 			b.accom_building_name, -->
<!-- 			b.accom_building_description,  -->
<!-- 			b.accom_building_phone, -->
<!-- 			b.accom_building_state, -->
<!-- 			b.accom_building_state_admin, -->
<!-- 			b.create_date, -->
<!-- 			b.update_date, -->
<!-- 			f.accom_building_facility_no, -->
<!-- 			f.accom_building_no, -->
<!-- 			f.accom_building_facility_name, -->
<!-- 			i.accom_building_image_no, -->
<!-- 			i.accom_building_image_name, -->
<!-- 			i.accom_building_image_ext, -->
<!-- 			s.accom_building_spot_no, -->
<!-- 			a.accom_address_no, -->
<!-- 			a.accom_address_zip, -->
<!-- 			h.hashtag_no -->
<!-- 		FROM       -->
<!-- 			accom_building b -->
<!-- 			LEFT JOIN accom_address a -->
<!-- 				ON b.accom_building_no = a.accom_building_no -->
<!-- 			LEFT JOIN accom_building_image i -->
<!-- 				ON b.accom_building_no = i.accom_building_no -->
<!-- 			LEFT JOIN accom_building_facility f -->
<!-- 				ON b.accom_building_no = f.accom_building_no -->
<!-- 			LEFT JOIN accom_building_spot s -->
<!-- 				ON b.accom_building_no = s.accom_building_no -->
<!-- 			LEFT JOIN hashtag h -->
<!-- 				ON b.accom_building_no = h.iden_no                                     -->
<!-- 		WHERE                                       -->
<!-- 			accom_building_state_admin = '승인완료' AND accom_building_state = '공개' -->
<!-- 			AND a.accom_building_no = #{accomBuildingNo} -->
<!-- 		ORDER BY -->
<!-- 			b.update_date DESC; -->
<!-- 	</select> -->
</mapper>