<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdu.voyage.mapper.ChatMapper">
	<!-- [사용자] 나의 채팅 목록 조회를 위한 resultMap -->
	<resultMap type="com.gdu.voyage.vo.Chat" id="resultChat">
		<!-- Chat -->
		<id column="chat_no" property="chatNo"/>
		<result column="to_member_id" property="toMemberId"/>
		<result column="from_member_id" property="fromMemberId"/>
		<result column="chat_content" property="chatContent"/>
		<result column="create_date" property="createDate"/>
		<result column="chat_read" property="chatRead"/>
		<!-- Member -->
		<association property="member" javaType="com.gdu.voyage.vo.Member">
			<id column="member_id" property="memberId"/>
			<result column="member_nickname" property="memberNickname"/>
			<result column="member_level" property="memberLevel"/>
		</association>
	</resultMap>
	
	<!-- [사용자] 나의 채팅 목록 조회  -->
	<!-- 보낸 사람의 닉네임도 같이 조회  -->
	<select id="selectChatListById" parameterType="String" resultMap="resultChat">
		SELECT
			c.chat_no,
			c.to_member_id,
			c.from_member_id,
			c.chat_content,
			c.create_date,
			c.chat_read,
			m.member_nickname,
			m.member_level
		FROM
			chat c
			LEFT JOIN member m
			ON c.to_member_id = m.member_id
		WHERE
			c.from_member_id = #{memberId}
		GROUP BY
			c.to_member_id
		ORDER BY
			c.create_date DESC
	</select>
</mapper>