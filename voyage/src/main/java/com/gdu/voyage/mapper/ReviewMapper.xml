<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdu.voyage.mapper.ReviewMapper">
	<!-- resultMap -->
	<resultMap type="com.gdu.voyage.vo.Review" id="resultReview">
		<!-- Review -->
		<id column="review_no" property="reviewNo"/>
		<result column="review_title" property="reviewTitle"/>
		<result column="review_star" property="reviewStar"/>
		<result column="review_view_cnt" property="reviewViewCnt"/>
		<result column="update_date" property="updateDate"/>
		<result column="create_date" property="createDate"/>
		<!-- Img -->
		<collection property="accomReviewImage" ofType="com.gdu.voyage.vo.AccomReviewImage">
			<id column="accom_review_image_no" property="accomReviewImageNo"/>
			<result column="accom_review_image_name" property="accomReviewImageName"/>
			<result column="accom_review_image_ext" property="accomReviewImageExt"/>
			<result column="accom_review_image_size" property="accomReviewImageSize"/>
		</collection>
	</resultMap>
	<!-- 숙소 후기 목록 조회 -->
	<select id="selectAccomReviewList" parameterType="com.gdu.voyage.vo.Review" resultMap="resultReview">
		SELECT
			review_no,
			payment_no,
			review_title,
			review_star,
			review_view_cnt,
			create_date,
			update_date
		FROM
			review
		ORDER BY
			update_date DESC
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	
	<!-- 페이징 -->
	<select id="selectCountPage" resultType="int">
		SELECT COUNT(*)FROM review
	</select>
	<select id="selectReviewTotalCount" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM review
		<where>
			<if test="paymentNo != null">
				paymentNo = #{paymentNo}
			</if>
		</where>
	</select>
	
	<!-- 숙소 후기 등록 -->
	<insert id="addAccomReview" parameterType="com.gdu.voyage.vo.Review">
		INSERT INTO review(
			payment_no,
			review_title,
			review_star,
			review_view_cnt,
			create_date,
			update_date
		) VALUES (
			#{paymentNo},
			#{reviewTitle},
			#{reviewStar},
			#{reviewViewCnt},
			NOW(),
			NOW()
		)
	</insert>
</mapper>